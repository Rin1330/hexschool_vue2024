<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vue2023 - Week5</title>
  <!-- Bootstrap Style -->
  <link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
  rel="stylesheet"
  integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
  crossorigin="anonymous"
/>
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@700&display=swap"
  rel="stylesheet"
/>
<link rel="stylesheet" href="./css/style.css" />
</head>
<body class="min-vh-100" style="background: repeating-linear-gradient(135deg, hsla(29, 92%, 70%, 1) 0%, hsla(0, 87%, 73%, 1) 100%); background: -webkit-repeating-linear-gradient(135deg, hsla(29, 92%, 70%, 1) 0%, hsla(0, 87%, 73%, 1) 100%); background: -moz-repeating-linear-gradient(135deg, hsla(29, 92%, 70%, 1) 0%, hsla(0, 87%, 73%, 1) 100%);">
  <div id="app">
    <div class="container">
      <h2 class="py-3 mb-0 fw-bold font-salsa">Product List</h2>
      <div class="row mb-4 g-0">
        <div class="col-lg-8">
          <div class="rounded p-3">
            <h2 class="text-center" v-if="status.hasProducts">正在努力加載產品</h2>
            <template v-else>
              <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3">
                <div class="col" v-for="product in products" :key="product.id">
                  <div class="card h-100 rounded-4 border-0 overflow-hidden">
                    <a href="javascript:;" @click="openModal(product)">
                      <img :src="product.imageUrl" class="card-img-top" :alt="product.title" style="height: 200px;">
                    </a>
                    <div class="card-body d-flex flex-column">
                      <h6 class="card-subtitle mb-3 text-body-secondary font-salsa">{{ product.title }}</h6>
                      <div class="text-center mt-auto">
                        <div class="d-flex align-items-center mb-2">
                          <div class="h4 mb-0 me-2">${{ product.price}} </div>
                          <small class="text-secondary"><del class="font-salsa">${{product.origin_price}} </del></small>
                        </div>
                        <button type="button" class="btn btn-outline-danger font-salsa">Add Cart</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </template>
          </div>
        </div>
        <div class="col-lg-4">
          <div class="rounded" style="background: linear-gradient(90deg, hsla(16, 100%, 76%, 1) 0%, hsla(49, 100%, 81%, 1) 100%); height: 500px;">

          </div>
        </div>
      </div>
      
      
    </div>
    <!-- Modal -->
    <div class="modal fade" id="productModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" ref="modal">
      <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content border-0">
          <div class="modal-header bg-dark text-white">
            <h5 class="modal-title" id="exampleModalLabel">
              <span>{{ tempProduct.title }}</span>
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-sm-6">
                <img class="img-fluid" :src="tempProduct.imageUrl" :alt="tempProduct.title" style="height: 350px;">
              </div>
              <div class="col-sm-6">
                <span class="badge bg-primary rounded-pill">{{ }}</span>
                <p>商品描述：{{tempProduct.description }}</p>
                <p>商品內容：{{ tempProduct.content }}</p>
                <template v-if="!tempProduct.origin_price">
                  <div class="h5">{{ tempProduct.price }} 元</div>
                </template>
                <template v-else>
                  <del class="h6">原價 {{tempProduct.origin_price }} 元</del>
                  <div class="h5">現在只要 {{ tempProduct.price }} 元</div>
                </template>
                <div>
                  <div class="input-group">
                    <input type="number" class="form-control" min="1">
                    <button type="button" class="btn btn-primary">加入購物車</button>
                  </div>
                </div>
              </div>
              <!-- col-sm-6 end -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <!-- VeeVaildation資源 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vee-validate/4.12.4/vee-validate.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@vee-validate/i18n@4.12.4/dist/vee-validate-i18n.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@vee-validate/rules@4.12.4/dist/vee-validate-rules.min.js"></script>

  <script type="module">
    import axios from "https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.5/esm/axios.min.js";
    import MainNav from './js/MainNav.js';

    // 定義規則
    Object.keys(VeeValidateRules).forEach(rule => {
      if (rule !== 'default') {
        VeeValidate.defineRule(rule, VeeValidateRules[rule]);
      }
    });

    // 讀取外部的資源
    VeeValidateI18n.loadLocaleFromURL('../json/zh_TW.json');

    // Activate the locale
    VeeValidate.configure({
      generateMessage: VeeValidateI18n.localize('zh_TW'),
      validateOnInput: true, // 調整為：輸入文字時，就立即進行驗證
    });
    

    const vm = Vue.createApp({
      data(){
        return {
          apiUrl: 'https://vue3-course-api.hexschool.io/v2',
          apiPath: 'delifans',
          cartModal: null,
          status:{
            hasProducts: false
          },
          products:[],
          tempProduct: {},
          form: {
            user: {
              name: '',
              email: '',
              tel: '',
              address: '',
            },
            message: ''
          },
          cart: {},
        }
      },
      methods: {
        getProducts() {
          axios.get(`${this.apiUrl}/api/${this.apiPath}/products`)
            .then(res =>{
              console.log(res.data);
              this.products = [...res.data.products]
            })
            .catch(err => {
              console.log(err);
            })
        },
        getCart() {

        },
        openModal(product) {
          this.cartModal.show()
          this.tempProduct = product
        },
        hideModal() {
          this.cartModal.hide()
        },
        onsubmit() {
          console.log('submit');
        }
      },
      mounted(){
        this.getProducts(),
        this.cartModal = new bootstrap.Modal('#productModal', {
          keyboard: false,
          backdrop: 'static'
        })
        // this.cartModal.show();
      }
    });

    vm.component('VForm', VeeValidate.Form);
    vm.component('VField', VeeValidate.Field);
    vm.component('ErrorMessage', VeeValidate.ErrorMessage);
    vm.mount('#app');

  </script>
</body>
</html>
